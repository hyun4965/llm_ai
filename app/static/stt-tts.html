<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>STT â†’ GPT â†’ TTS Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #f3f4f6;
      --card-bg: #ffffff;
      --text-main: #111827;
      --text-muted: #6b7280;
      --primary: #2563eb;
      --primary-soft: #e0ecff;
      --border-subtle: #e5e7eb;
      --danger: #dc2626;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui,
        sans-serif;
      background: radial-gradient(circle at top, #e0edff 0, var(--bg) 45%);
      color: var(--text-main);
    }

    .page {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 32px 16px;
    }

    .card {
      width: 100%;
      max-width: 880px;
      background: var(--card-bg);
      border-radius: 20px;
      box-shadow: 0 22px 50px rgba(15, 23, 42, 0.12);
      padding: 24px 22px 22px;
      border: 1px solid var(--border-subtle);
    }

    header {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      align-items: center;
      margin-bottom: 16px;
    }

    .title {
      font-size: 22px;
      font-weight: 700;
    }

    .subtitle {
      font-size: 13px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    nav {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      font-size: 12px;
    }

    nav a {
      text-decoration: none;
      color: var(--text-muted);
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid transparent;
    }

    nav a:hover {
      background: var(--primary-soft);
      color: var(--primary);
      border-color: #bfd4ff;
    }

    nav a.active {
      background: var(--primary);
      color: white;
    }

    .layout {
      margin-top: 12px;
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.1fr);
      gap: 16px;
    }

    .col {
      padding: 10px 10px 8px;
      border-radius: 14px;
      background: #f9fafb;
      border: 1px solid var(--border-subtle);
    }

    .col-title {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin-bottom: 6px;
    }

    .output-box {
      padding: 10px;
      border-radius: 10px;
      background: white;
      border: 1px dashed var(--border-subtle);
      font-size: 14px;
      min-height: 70px;
      white-space: pre-wrap;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 8px 16px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      margin-top: 6px;
      background: var(--primary);
      color: white;
      min-width: 160px;
    }

    .btn.recording {
      background: var(--danger);
    }

    .status {
      margin-top: 8px;
      font-size: 12px;
      color: var(--text-muted);
    }

    .audio-wrapper {
      margin-top: 12px;
    }

    audio {
      width: 100%;
    }

    footer {
      margin-top: 14px;
      font-size: 11px;
      color: var(--text-muted);
    }

    @media (max-width: 820px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 640px) {
      .card {
        padding: 18px 16px 16px;
      }

      header {
        flex-direction: column;
        align-items: flex-start;
      }

      .title {
        font-size: 18px;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="card">
      <header>
        <div>
          <div class="title">ğŸ§© STT â†’ GPT â†’ TTS íŒŒì´í”„ë¼ì¸</div>
          <div class="subtitle">
            í•œ ë²ˆì˜ ë…¹ìŒìœ¼ë¡œ <code>/stt-tts/</code> ì—”ë“œí¬ì¸íŠ¸ë¥¼ í˜¸ì¶œí•˜ì—¬ STT, GPT
            ì‘ë‹µ, TTSê¹Œì§€ ìˆœì°¨ ì²˜ë¦¬í•©ë‹ˆë‹¤.
          </div>
        </div>
        <nav>
          <a href="index.html">í™ˆ</a>
          <a href="stt.html">STT</a>
          <a href="tts.html">TTS</a>
          <a href="stt-tts.html" class="active">STTâ†’GPTâ†’TTS</a>
        </nav>
      </header>

      <main>
        <button id="recordBtn" class="btn">ğŸ§ ë…¹ìŒ ì‹œì‘</button>
        <div id="recordStatus" class="status">
          ë²„íŠ¼ì„ ëˆŒëŸ¬ ë…¹ìŒì„ ì‹œì‘í•˜ë©´, ë…¹ìŒì´ ëë‚œ ë’¤ STT â†’ GPT â†’ TTSê°€ ìˆœì„œëŒ€ë¡œ
          ì‹¤í–‰ë©ë‹ˆë‹¤.
        </div>

        <div class="layout">
          <section class="col">
            <div class="col-title">STT í…ìŠ¤íŠ¸</div>
            <div id="sttText" class="output-box">
              ì•„ì§ STT ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.
            </div>
          </section>

          <section class="col">
            <div class="col-title">GPT ì‘ë‹µ</div>
            <div id="gptResponse" class="output-box">
              ì•„ì§ GPT ì‘ë‹µì´ ì—†ìŠµë‹ˆë‹¤.
            </div>
          </section>
        </div>

        <div class="audio-wrapper">
          <div class="col-title" style="margin-top:12px;">TTS ì˜¤ë””ì˜¤</div>
          <audio id="ttsAudio" controls style="display:none;"></audio>
        </div>
      </main>

      <footer>
        ì„œë²„ëŠ” ì—…ë¡œë“œëœ webm íŒŒì¼ì„ wavë¡œ ë³€í™˜í•œ ë’¤ STT, GPT, TTSë¥¼ ìˆœì°¨ì ìœ¼ë¡œ
        ì²˜ë¦¬í•˜ê³ , ì‘ë‹µ JSONì˜ <code>stt_text</code>,
        <code>gpt_response</code>, <code>tts_file_path</code>ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
      </footer>
    </div>
  </div>

  <script>
    let isRecording = false;
    let mediaRecorder;
    let audioChunks = [];

    const btn = document.getElementById("recordBtn");
    const sttTextEl = document.getElementById("sttText");
    const gptResponseEl = document.getElementById("gptResponse");
    const ttsAudioEl = document.getElementById("ttsAudio");
    const statusEl = document.getElementById("recordStatus");

    btn.addEventListener("click", async () => {
      if (!isRecording) {
        try {
          const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
          mediaRecorder = new MediaRecorder(stream);
          audioChunks = [];

          mediaRecorder.ondataavailable = (e) => audioChunks.push(e.data);

          mediaRecorder.onstop = async () => {
            statusEl.textContent = "ì„œë²„ë¡œ ìŒì„±ì„ ì „ì†¡ ì¤‘ì…ë‹ˆë‹¤...";
            const blob = new Blob(audioChunks, { type: "audio/webm" });
            const formData = new FormData();
            formData.append("audio", blob, "recording.webm");

            try {
              const res = await fetch("/stt-tts/", {
                method: "POST",
                body: formData,
              });

              const data = await res.json();
              sttTextEl.textContent = "STT í…ìŠ¤íŠ¸: " + (data.stt_text || "(ì—†ìŒ)");
              gptResponseEl.textContent =
                "GPT ì‘ë‹µ: " + (data.gpt_response || "(ì—†ìŒ)");

              if (data.tts_file_path) {
                ttsAudioEl.src = data.tts_file_path + "?v=" + new Date().getTime();
                ttsAudioEl.style.display = "block";
                ttsAudioEl.play();
              } else {
                ttsAudioEl.style.display = "none";
              }
            } catch (err) {
              sttTextEl.textContent = "ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
              gptResponseEl.textContent = "";
            } finally {
              statusEl.textContent =
                "ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë…¹ìŒí•˜ë ¤ë©´ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì£¼ì„¸ìš”.";
            }
          };

          mediaRecorder.start();
          isRecording = true;
          btn.textContent = "â–  ë…¹ìŒ ì¢…ë£Œ";
          btn.classList.add("recording");
          statusEl.textContent = "ë…¹ìŒ ì¤‘ì…ë‹ˆë‹¤...";
        } catch (err) {
          statusEl.textContent = "ë§ˆì´í¬ ê¶Œí•œì„ í—ˆìš©í•´ ì£¼ì„¸ìš”.";
        }
      } else {
        mediaRecorder.stop();
        isRecording = false;
        btn.textContent = "ğŸ§ ë…¹ìŒ ì‹œì‘";
        btn.classList.remove("recording");
      }
    });
  </script>
</body>
</html>